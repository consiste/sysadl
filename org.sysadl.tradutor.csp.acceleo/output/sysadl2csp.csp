DIAGRAM =  (COMPONENTS [| Events |] CONNECTORS)

COMPONENTS =FactoryAutomationSystem									
|||AGVSystem									
|||VehicleControl									

CONNECTORS =dataExchange_interactionAGVAndSupervisory_in_outDataS_To_in_outDataAgv
|||updateStatus_status_sendStatus_To_receiveStatus
|||arrived_locationVehicle_arrivalDetected_out_To_arrivalDetected_in
|||ackArm_notificationArm_started_To_startedArm
|||cmdArm_commandArm_startArm_To_start
|||ackMotor_notificationMotor_started_stopped_out_To_started_stopped_in
|||cmdMotor_commandMotor_start_stop_out_To_start_stop_in
|||destinationStation_locationVehicle_destination_To_destination_vt
|||destinationStation_locationVehicle_destination_To_destination_cs
|||command_commandArm_cmd_sm_To_cmd
|||command_commandArm_cmd_sm_To_cmd_ca
|||currentLocation_locationVehicle_location_cs_To_location_vt
|||sendNotificationMotor_notificationMotor_outAck_To_ack_ca
|||sendNotificationMotor_notificationMotor_outAck_To_ack_cs
|||DELEGATIONS

assert DIAGRAM:[deadlock free]
assert DIAGRAM:[livelock free]

datatype NotificationToSupervisory = departed|arrived|passed|traveling 					
datatype NotificationFromArm = loaded|unloaded 					
datatype CommandToArm = load|unload|idle 					
datatype NotificationFromMotor = started|stopped 					
datatype CommandToMotor = start|stop 					
Status = { location.destination.command | location<- Location ,destination<- Location ,command<- CommandToArm  }
Location = { location | location<- Char  }
VehicleData = { destination.command | destination<- Location ,command<- CommandToArm  }
channel ss_in_outDataS_outMoveToStation_ISupervisorySystem : VehicleData
channel ss_in_outDataS_inNotifications_ISupervisorySystem : NotificationToSupervisory
channel agvs_sendStatus_outStatus : Status
channel agvs_in_outDataAgv_inMoveToStation_IAGVSystem : VehicleData
channel agvs_in_outDataAgv_outNotifications_IAGVSystem : NotificationToSupervisory
channel ds_receiveStatus_inStatus : Status

FactoryAutomationSystem = ss_SupervisorySystem|||agvs_AGVSystem|||ds_DisplaySystem
						
ss_SupervisorySystem = 
ss_in_outDataS_inNotifications_ISupervisorySystem?notificationtosupervisory ->										 												
|~|vehicledata:VehicleData @ ss_in_outDataS_outMoveToStation_ISupervisorySystem!vehicledata ->										 												
ss_SupervisorySystem

agvs_AGVSystem = 								
agvs_in_outDataAgv_inMoveToStation_IAGVSystem?vehicledata ->											 												
agvs_sendStatus_outStatus!status ->																			
agvs_in_outDataAgv_outNotifications_IAGVSystem!notificationtosupervisory ->												 												
agvs_AGVSystem
			
ds_DisplaySystem = 
ds_receiveStatus_inStatus?status ->
ds_DisplaySystem

dataExchange_interactionAGVAndSupervisory_in_outDataS_To_in_outDataAgv =
ss_in_outDataS_inNotifications_ISupervisorySystem?notificationtosupervisory	->																																
ss_in_outDataS_outMoveToStation_ISupervisorySystem!vehicledata	->																																
agvs_in_outDataAgv_inMoveToStation_IAGVSystem?vehicledata ->																																
agvs_in_outDataAgv_outNotifications_IAGVSystem!notificationtosupervisory ->																																	
dataExchange_interactionAGVAndSupervisory_in_outDataS_To_in_outDataAgv
														
updateStatus_status_sendStatus_To_receiveStatus =
agvs_sendStatus_outStatus?status->								
ds_receiveStatus_inStatus!status->								
updateStatus_status_sendStatus_To_receiveStatus
														
channel m_start_stop_in_inCommandToMotor : CommandToMotor
channel m_started_stopped_out_outNotificationFromMotor : NotificationFromMotor
channel as_arrivalDetected_out_outLocation : Location
channel ra_start_inCommandToArm : CommandToArm
channel ra_started_outNotificationFromArm : NotificationFromArm
channel vc_sendStatus_outStatus : Status
channel vc_arrivalDetected_in_inLocation : Location
channel vc_startArm_outCommandToArm : CommandToArm
channel vc_startedArm_inNotificationFromArm : NotificationFromArm
channel vc_started_stopped_in_inNotificationFromMotor : NotificationFromMotor
channel vc_start_stop_out_outCommandToMotor : CommandToMotor
channel vc_in_outData_inMoveToStation_IAGVSystem : VehicleData
channel vc_in_outData_outNotifications_IAGVSystem : NotificationToSupervisory

AGVSystem = m_Motor|||as_ArrivalSensor|||ra_RobotArm|||vc_VehicleControl
						
m_Motor = 
m_start_stop_in_inCommandToMotor?commandtomotor ->
|~| notificationfrommotor:NotificationFromMotor @ m_started_stopped_out_outNotificationFromMotor!notificationfrommotor ->
m_Motor

as_ArrivalSensor = 
|~| location:Location @ as_arrivalDetected_out_outLocation!location ->
as_ArrivalSensor

ra_RobotArm = 
ra_start_inCommandToArm?commandtoarm ->
|~| notificationfromarm:NotificationFromArm @ ra_started_outNotificationFromArm!notificationfromarm ->
ra_RobotArm

vc_VehicleControl = 								
vc_arrivalDetected_in_inLocation?location ->																				
vc_startedArm_inNotificationFromArm?notificationfromarm ->																				
vc_started_stopped_in_inNotificationFromMotor?notificationfrommotor ->																				
vc_in_outData_inMoveToStation_IAGVSystem?vehicledata ->											 												
vc_sendStatus_outStatus!status ->																			
vc_startArm_outCommandToArm!commandtoarm ->																			
vc_start_stop_out_outCommandToMotor!commandtomotor ->																			
vc_in_outData_outNotifications_IAGVSystem!notificationtosupervisory ->												 												
vc_VehicleControl
			
arrived_locationVehicle_arrivalDetected_out_To_arrivalDetected_in =
as_arrivalDetected_out_outLocation?location->								
vc_arrivalDetected_in_inLocation!location->								
arrived_locationVehicle_arrivalDetected_out_To_arrivalDetected_in
														
ackArm_notificationArm_started_To_startedArm =
ra_started_outNotificationFromArm?notificationfromarm->								
vc_startedArm_inNotificationFromArm!notificationfromarm->								
ackArm_notificationArm_started_To_startedArm
														
cmdArm_commandArm_startArm_To_start =
ra_start_inCommandToArm!commandtoarm->								
vc_startArm_outCommandToArm?commandtoarm->								
cmdArm_commandArm_startArm_To_start
														
ackMotor_notificationMotor_started_stopped_out_To_started_stopped_in =
m_started_stopped_out_outNotificationFromMotor?notificationfrommotor->								
vc_started_stopped_in_inNotificationFromMotor!notificationfrommotor->								
ackMotor_notificationMotor_started_stopped_out_To_started_stopped_in
														
cmdMotor_commandMotor_start_stop_out_To_start_stop_in =
m_start_stop_in_inCommandToMotor!commandtomotor->								
vc_start_stop_out_outCommandToMotor?commandtomotor->								
cmdMotor_commandMotor_start_stop_out_To_start_stop_in
														
channel cs_ack_cs_inNotificationFromMotor : NotificationFromMotor
channel cs_location_cs_outLocation : Location
channel cs_destination_cs_inLocation : Location
channel cs_stop_outCommandToMotor : CommandToMotor
channel cs_arrivalDetected_inLocation : Location
channel cs_passed_outNotificationToSupervisory : NotificationToSupervisory
channel ca_cmd_ca_inCommandToArm : CommandToArm
channel ca_ack_ca_inNotificationFromMotor : NotificationFromMotor
channel ca_startArm_outCommandToArm : CommandToArm
channel nm_inAck_inNotificationFromMotor : NotificationFromMotor
channel nm_ack_outNotificationToSupervisory : NotificationToSupervisory
channel nm_outAck_outNotificationFromMotor : NotificationFromMotor
channel sm_move_inVehicleData : VehicleData
channel sm_cmd_sm_outCommandToArm : CommandToArm
channel sm_destination_outLocation : Location
channel sm_start_outCommandToMotor : CommandToMotor
channel na_arrivedStatus_outNotificationToSupervisory : NotificationToSupervisory
channel na_loaded_unloaded_inNotificationFromArm : NotificationFromArm
channel vt_AGVStatus_outStatus : Status
channel vt_location_vt_inLocation : Location
channel vt_destination_vt_inLocation : Location
channel vt_cmd_inCommandToArm : CommandToArm

VehicleControl = cs_CheckStation|||ca_ControlArm|||nm_NotifierMotor|||sm_StartMoving|||na_NotifierArm|||vt_VehicleTimer
						
cs_CheckStation = 								
cs_ack_cs_inNotificationFromMotor?notificationfrommotor ->																				
cs_destination_cs_inLocation?location ->																				
cs_arrivalDetected_inLocation?location ->																				
cs_location_cs_outLocation!location ->																			
cs_stop_outCommandToMotor!commandtomotor ->																			
cs_passed_outNotificationToSupervisory!notificationtosupervisory ->																			
cs_CheckStation
			
ca_ControlArm = 								
ca_cmd_ca_inCommandToArm?commandtoarm ->																				
ca_ack_ca_inNotificationFromMotor?notificationfrommotor ->																				
ca_startArm_outCommandToArm!commandtoarm ->																			
ca_ControlArm
			
nm_NotifierMotor = 								
nm_inAck_inNotificationFromMotor?notificationfrommotor ->																				
nm_ack_outNotificationToSupervisory!notificationtosupervisory ->																			
nm_outAck_outNotificationFromMotor!notificationfrommotor ->																			
nm_NotifierMotor
			
sm_StartMoving = 								
sm_move_inVehicleData?vehicledata ->																				
sm_cmd_sm_outCommandToArm!commandtoarm ->																			
sm_destination_outLocation!location ->																			
sm_start_outCommandToMotor!commandtomotor ->																			
sm_StartMoving
			
na_NotifierArm = 								
na_loaded_unloaded_inNotificationFromArm?notificationfromarm ->																				
na_arrivedStatus_outNotificationToSupervisory!notificationtosupervisory ->																			
na_NotifierArm
			
vt_VehicleTimer = 								
vt_location_vt_inLocation?location ->																				
vt_destination_vt_inLocation?location ->																				
vt_cmd_inCommandToArm?commandtoarm ->																				
vt_AGVStatus_outStatus!status ->																			
vt_VehicleTimer
			
destinationStation_locationVehicle_destination_To_destination_vt =
sm_destination_outLocation?location->								
vt_destination_vt_inLocation!location->								
destinationStation_locationVehicle_destination_To_destination_vt
														
destinationStation_locationVehicle_destination_To_destination_cs =
cs_destination_cs_inLocation!location->								
sm_destination_outLocation?location->								
destinationStation_locationVehicle_destination_To_destination_cs
														
command_commandArm_cmd_sm_To_cmd =
sm_cmd_sm_outCommandToArm?commandtoarm->								
vt_cmd_inCommandToArm!commandtoarm->								
command_commandArm_cmd_sm_To_cmd
														
command_commandArm_cmd_sm_To_cmd_ca =
ca_cmd_ca_inCommandToArm!commandtoarm->								
sm_cmd_sm_outCommandToArm?commandtoarm->								
command_commandArm_cmd_sm_To_cmd_ca
														
currentLocation_locationVehicle_location_cs_To_location_vt =
cs_location_cs_outLocation?location->								
vt_location_vt_inLocation!location->								
currentLocation_locationVehicle_location_cs_To_location_vt
														
sendNotificationMotor_notificationMotor_outAck_To_ack_ca =
ca_ack_ca_inNotificationFromMotor!notificationfrommotor->								
nm_outAck_outNotificationFromMotor?notificationfrommotor->								
sendNotificationMotor_notificationMotor_outAck_To_ack_ca
														
sendNotificationMotor_notificationMotor_outAck_To_ack_cs =
cs_ack_cs_inNotificationFromMotor!notificationfrommotor->								
nm_outAck_outNotificationFromMotor?notificationfrommotor->								
sendNotificationMotor_notificationMotor_outAck_To_ack_cs
														
Delegation_sendStatus_To_sendStatus= vc_sendStatus_outStatus?status ->
agvs_sendStatus_outStatus!status ->
Delegation_sendStatus_To_sendStatus

Delegation_in_outData_To_in_outData= vc_in_outData_inMoveToStation_IAGVSystem!vehicledata->
vc_in_outData_outNotifications_IAGVSystem!notificationtosupervisory->
Delegation_in_outData_To_in_outData

Delegation_ack_To_outNotifications= nm_ack_outNotificationToSupervisory?notificationtosupervisory ->
vc_in_outData_outNotifications_IAGVSystem!notificationtosupervisory ->
Delegation_ack_To_outNotifications

Delegation_arrivedStatus_To_outNotifications= na_arrivedStatus_outNotificationToSupervisory?notificationtosupervisory ->
vc_in_outData_outNotifications_IAGVSystem!notificationtosupervisory ->
Delegation_arrivedStatus_To_outNotifications

Delegation_move_To_inMoveToStation= Delegation_move_To_inMoveToStation

Delegation_passed_To_outNotifications= cs_passed_outNotificationToSupervisory?notificationtosupervisory ->
vc_in_outData_outNotifications_IAGVSystem!notificationtosupervisory ->
Delegation_passed_To_outNotifications

Delegation_loaded_unloaded_To_startedArm= Delegation_loaded_unloaded_To_startedArm

Delegation_inAck_To_started_stopped= Delegation_inAck_To_started_stopped

Delegation_startArm_To_startArm= ca_startArm_outCommandToArm?commandtoarm ->
vc_startArm_outCommandToArm!commandtoarm ->
Delegation_startArm_To_startArm

Delegation_AGVStatus_To_sendStatus= vt_AGVStatus_outStatus?status ->
vc_sendStatus_outStatus!status ->
Delegation_AGVStatus_To_sendStatus

Delegation_start_To_start_stop= sm_start_outCommandToMotor?commandtomotor ->
Delegation_start_To_start_stop

Delegation_stop_To_start_stop= cs_stop_outCommandToMotor?commandtomotor ->
Delegation_stop_To_start_stop

Delegation_arrivalDetected_To_arrivalDetected= cs_arrivalDetected_inLocation!location ->
Delegation_arrivalDetected_To_arrivalDetected

DELEGATIONS = Delegation_sendStatus_To_sendStatus ||| 
Delegation_in_outData_To_in_outData ||| 
Delegation_ack_To_outNotifications ||| 
Delegation_arrivedStatus_To_outNotifications ||| 
Delegation_move_To_inMoveToStation ||| 
Delegation_passed_To_outNotifications ||| 
Delegation_loaded_unloaded_To_startedArm ||| 
Delegation_inAck_To_started_stopped ||| 
Delegation_startArm_To_startArm ||| 
Delegation_AGVStatus_To_sendStatus ||| 
Delegation_start_To_start_stop ||| 
Delegation_stop_To_start_stop ||| 
Delegation_arrivalDetected_To_arrivalDetected
	
